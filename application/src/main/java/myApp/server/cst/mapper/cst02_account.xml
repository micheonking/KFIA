<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cst02_account">

	<resultMap 	id="mapper" type="myApp.client.vi.cst.model.Cst02_AccountModel" >
		<id		column="cst02_account_id"		property="accountId"/>
		<result	column="cst02_user_id"			property="userId"/>
		<result	column="cst02_mg_cd"			property="mgCode"/>
		<result	column="cst02_account_no"		property="accountNo"/>
		<result	column="cst02_fund_cd"			property="fundCode"/>
		<result	column="cst02_account_nm"		property="accountName"/>
		<result	column="cst02_account_branch"	property="accountBranch"/>
		<result	column="cst02_branch_manager"	property="branchManager"/>
		<result	column="cst02_manager_contact"	property="managerContact"/>
	</resultMap>

	<resultMap type="myApp.client.vi.sys.model.Sys00_CommonComboBoxModel" id="mapper2">
		<id     column="code"           		property="code"/>
		<result column="name"          			property="name"/>
	</resultMap>

	<select id="selectById" resultMap="mapper" parameterType="Long" >
		select	*
		from	cst02_account
		where	cst02_account_id	=	#{accountId}
	</select>

	<select id="getAccInfo" resultMap="mapper" parameterType="HashMap">
		select	fund_cd as cst02_fund_cd
		     ,  fund_nm as cst02_account_nm 
		  from	cst03_icam_accounts
	  	 where	mg_cd   = #{mgCode}
		   and	acc_no	= #{accountNo}
		   and  rownum = 1
	</select>

	<select id="selectFundCodeList" resultMap="mapper2" parameterType="HashMap">
		select concat(rpad(substr(cst02_account_no,1,3),12,'*'),'  '||cst02_account_nm||'('||cst02_fund_cd||')') as name
		     , cst02_fund_cd as code
		  from cst02_account
		 where cst02_user_id = #{userId}
		 order by cst02_account_id
	</select>

	<select id="selectMgCombo" resultMap="mapper2" parameterType="HashMap">
		select	mg_cd_nm||decode(mg_cd,'00028','(구)') as name
		     ,  mg_cd as code
		  from	cst03_icam_accounts
		 group	by mg_cd_nm, mg_cd 
		 order	by 2
	</select>
	
	<select id="selectYearCombo" resultMap="mapper2" parameterType="HashMap">
		select to_char(sys12_day,'yyyy')||'년도' as name
		     , to_char(sys12_day,'yyyy') as code
		  from cst03_icam_accounts
		     , sys12_calendar  
		 where sys12_day between fst_seolj_ymd and trunc(sysdate)
		   and fund_cd = #{fundCode}
		   and to_char(sys12_day,'mmdd') >= '0331'
		 group by to_char(sys12_day,'yyyy')
		 order by 1 desc
 	</select>

	<select id="selectSettlementDateCombo" resultMap="mapper2" parameterType="HashMap">
		select to_char(tr_ymd, 'yyyy-mm-dd') as name
		     , to_char(tr_ymd, 'yyyymmdd') as code
		  from cst04_icam_accounts_date_info
		 where fund_cd = #{fundCode}
		   and tr_nm = '결산'
		 order by tr_ymd desc
 	</select>

	<select id="getSettlementDate" resultType="String" parameterType="HashMap">
		select to_char(bf_gyul_ymd,'yyyy.mm.dd')||to_char(af_gyul_ymd,'yyyy.mm.dd') as code
		  from cst04_icam_accounts_date_info
		 where fund_cd = #{fundCode}
		   and tr_ymd = #{ymd}
 	</select>

	<select id="getPreDate" resultType="String" parameterType="HashMap">
	    select to_char(sysdate - 1,'yyyy-mm-dd') as preDate
	      from dual
	</select>

</mapper>